// wuw â€“ https://github.com/fasttime/wuw
"use strict";{const e=CSSStyleDeclaration.prototype.item,t=Error,n=t.captureStackTrace,o=JSON.stringify,r=Math.floor,i=Math.max,c=Node.prototype.hasChildNodes,s=Object.create,a=Object.defineProperties,f=Object.defineProperty,u=Object.entries,d=Object.freeze,l=Object.getOwnPropertyDescriptors,p=Object.keys,w=Proxy,g=w.revocable,m=RangeError,h=Reflect.defineProperty,y=Reflect.deleteProperty,b=Reflect.get,k=Reflect.getPrototypeOf,R=Reflect.setPrototypeOf,v=Reflect.set,P=Set,A=String,F=TypeError,L=console.error,T=console.log,C=console.warn,M="object"==typeof module?require("perf_hooks").performance:performance;function defineConstant(e,t,n){f(e,t,{configurable:!0,value:n})}function defineFunction(e,t,n){f(n,"name",{configurable:!0,value:t}),defineConstant(e,t,n)}function defineVariable(e,t,n,o){f(e,t,{configurable:!0,get:n,set:o})}const{installCallback:O,notify:$,uninstallCallback:j}=(()=>{const e=new P;return{installCallback:function(t){e.add(t)},notify:function(t){for(const n of e)try{n(t)}catch(e){L(e)}},uninstallCallback:function(t){e.delete(t)}}})();let x;const{unwatchAs:S,watchAs:U}=(()=>{function o(e,t){const n=k(e);return R(e,k(t)),n}function r(e){try{c.call(e)}catch(e){return!1}return!0}function i(){return M.now()}function f(e,t){const n=l(e),o=p(n).filter(o=>!(n[o].configurable&&y(e,o)||(delete n[o],t.has(o)||(t.add(o),0))));return o.length&&x&&x(e,o),n}const m={get:function(e,t,n){const o=L.get(e);return b(e,t,o&&o.spy===n?e:n)},set:function e(t,n,o,r){const c=L.get(t);return c&&c.spy===r?(T.has(c.wuwTarget)?function(t,n,o){const r={target:t,propertyKey:n,stackTrace:C(e),startTime:i()};let c,s;try{c=v(t,n,o),r.success=c}catch(e){s=e,r.error=s}if(r.endTime=i(),d(r),$(r),void 0!==s)throw s;return c}:v)(t,n,o):v(t,n,o,r)}},A={get:function(t,n,r){const i=T.get(r);return(i&&t===i.mirror?function(t,n,r){const i=o(r,t);let c;try{c=b(t,n,r)}finally{R(r,i)}return function(t,n,o){if("style"===n&&function(t){try{e.call(t,-1)}catch(e){return!1}return!0}(o)){let e=L.get(o);if(e)o=e.spy;else{const n=new w(o,m);e={spy:n,wuwTarget:t},L.set(o,e),o=n}}return o}(r,n,c)}:b)(t,n,r)},set:function e(t,n,r,c){const s=T.get(c);return s&&t===s.mirror?function({remarkedPropertyKeys:t},n,r,c,s){const u={target:s,propertyKey:r,stackTrace:C(e),startTime:i()},l=o(s,n);let p,w;try{p=v(n,r,c,s),u.success=p}catch(e){w=e,u.error=w}const g=f(s,t);if(a(n,g),R(s,l),u.endTime=i(),d(u),$(u),void 0!==w)throw w;return p}(s,t,n,r,c):v(t,n,r,c)}},L=new WeakMap,T=new WeakMap,C=(()=>{const e=n?e=>{const t={};return n(t,e),t.stack.replace(/^.{5}\n/,"")}:()=>t().stack.replace(/^(Error\n)?(?:.*\n){4}/,"");return"stackTraceLimit"in t?n=>{const{stackTraceLimit:o}=t;t.stackTraceLimit=1/0;const r=e(n);return t.stackTraceLimit=o,r}:t=>e(t)})();return{unwatchAs:function(e,t){if(void 0===t)throw F(`Argument of ${e} is missing or undefined`);if(!r(t))throw F(`Argument of ${e} does not implement interface Node`);const n=T.get(t);if(n){const{mirror:e,revoke:o}=n;o(),function(e,t){const n=u(t);for(const[t,o]of n)h(e,t,o)}(t,l(e)),R(t,k(e)),T.delete(t)}return K},watchAs:function(e,t){if(void 0===t)throw F(`Argument of ${e} is missing or undefined`);if(!r(t))throw F(`Argument of ${e} does not implement interface Node`);if(!T.has(t)){const e=new P,n=f(t,e),o=s(k(t),n),{proxy:r,revoke:i}=g(o,A);R(t,r),T.set(t,{mirror:o,remarkedPropertyKeys:e,revoke:i})}return K}}})(),K=e=>U("wuw",e),N={};defineConstant(K,"watching",N),defineFunction(K,"watch",e=>U("wuw.watch",e)),defineFunction(K,"unwatch",e=>S("wuw.unwatch",e)),defineFunction(N,"watch",e=>U("wuw.watching.watch",e)),defineFunction(N,"unwatch",e=>S("wuw.watching.unwatch",e)),defineFunction("undefined"==typeof self?global:self,"wuw",K);{function formatList(e){let t="",n=0;for(let o=e.length;--o>=0;){switch(n++){case 0:break;case 1:t=` and ${t}`;break;default:t=`, ${t}`}t=e[o]+t}return t}function formatPropertyKey(e){return("string"==typeof e?o:A)(e)}function getRemarkUndeletableProperties(){return x}function setRemarkUndeletableProperties(e){if(void 0!==e&&null!==e&&"function"!=typeof e)throw F("remarkUndeletableProperties must be a function, undefined or null");x=e||null}defineConstant(N,"defaultRemarkUndeletableProperties",x=((e,t)=>{const n=formatList(t.map(formatPropertyKey));C("The target object %o has undeletable properties: %s",e,n)})),defineVariable(N,"remarkUndeletableProperties",getRemarkUndeletableProperties,setRemarkUndeletableProperties)}function doAs(e,t){if(void 0===t)throw F(`Argument of ${e} is missing or undefined`);if("function"!=typeof t)throw F(`Argument of ${e} is not a function`);return O(t),K}function dontAs(e,t){if(void 0===t)throw F(`Argument of ${e} is missing or undefined`);if("function"!=typeof t)throw F(`Argument of ${e} is not a function`);return j(t),K}const E={};defineConstant(K,"doing",E),defineFunction(K,"do",e=>doAs("wuw.do",e)),defineFunction(K,"dont",e=>dontAs("wuw.dont",e)),defineFunction(E,"do",e=>doAs("wuw.doing.do",e)),defineFunction(E,"dont",e=>dontAs("wuw.doing.dont",e));{let e=0;const t=1e4,n=[],o=()=>{e=0,n.splice(0,1/0)};function getMaxRecords(){return t}function*log(){for(;e<n.length;)yield n[e++]}function logRecord(o){n.length>=t&&(e&&--e,n.shift()),n.push(o)}function setMaxRecords(o){if((o=+o)<0||o!==r(o))throw m("Invalid number of records");t=o+0;const c=n.length-t;c>0&&(e=i(e-c,0),n.splice(0,c))}const c=()=>n.slice();O(logRecord),defineFunction(K,"clear",o),defineConstant(K,"defaultMaxRecords",t),defineFunction(K,"log",log),defineVariable(K,"maxRecords",getMaxRecords,setMaxRecords),defineFunction(K,"snapshot",c)}{let e=null;const t="undefined"!=typeof setImmediate?()=>void setImmediate(printLiveRecords):(()=>{const{port1:e,port2:t}=new MessageChannel;return e.onmessage=printLiveRecords,()=>t.postMessage()})(),n=()=>(j(printLiveRecordLater),K),o=()=>(O(printLiveRecordLater),K);function printLiveRecordLater(n){e?e.push(n):(e=[n],t())}function printLiveRecords(){for(;;){const t=e.shift();if(!t)break;T("wuw record\n%o",t)}e=null}{const e=()=>o();defineFunction(e,"on",o),defineFunction(e,"off",n),defineFunction(K,"live",e)}}}