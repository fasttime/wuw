// wuw – https://github.com/fasttime/wuw
"use strict";{const e=CSSStyleDeclaration.prototype.item,t=Error,r=t.captureStackTrace,n=Intl.ListFormat,o=JSON.stringify,s=Math.floor,a=Node.prototype.hasChildNodes,l=Object,{create:c,defineProperties:i,defineProperty:u,freeze:g,getOwnPropertyDescriptors:d,getOwnPropertyNames:f,getOwnPropertySymbols:p}=l,m=Proxy,w=m.revocable,y=RangeError,{defineProperty:h,deleteProperty:k,get:b,getPrototypeOf:T,setPrototypeOf:v,set:P}=Reflect,L=Set,x=String,S=Symbol,C=TypeError,$=console,{error:A,groupCollapsed:E,groupEnd:_,log:M,warn:O}=$,N=performance,R=e=>"string"==typeof e?o(e):o(x(e)).slice(1,-1),I=(e,t,r)=>u(e,t,{configurable:!0,value:r}),K=(e,t,r)=>{const n=i((...e)=>{try{return G=o,r(...e)}finally{G=void 0}},{length:{configurable:!0,value:r.length},name:{configurable:!0,value:t}}),o=U(e,t,n).join(".");return n},U=(e,t,r)=>{const n=(D.get(e)||[]).concat(t);return D.set(r,n),I(e,t,r),n},j=(e,t,r,n)=>u(e,t,{configurable:!0,get:r,set:n});let G,D=new Map;const W=()=>z.forEach(e=>e()),z=[],{installCallback:F,isCallbackInstalled:J,notify:q,uninstallAllCallbacks:B,uninstallCallback:H}=(()=>{const e=()=>t.clear(),t=new L;return z.push(e),{installCallback:e=>t.add(e),isCallbackInstalled:e=>t.has(e),notify:e=>{for(const r of t)try{r(e)}catch(e){A(e)}},uninstallAllCallbacks:e,uninstallCallback:e=>t.delete(e)}})(),Q={},V=(()=>{const n=(()=>{const e=r?e=>{const t={};return r(t,e),t.stack.replace(/^.{5}\n/,"")}:e=>Y(e,t());return"stackTraceLimit"in t?r=>{const{stackTraceLimit:n}=t;t.stackTraceLimit=1/0;const o=e(r);return t.stackTraceLimit=n,o}:e})(),o=({wuwTarget:e})=>{const t=H.get(e);if(t){if(t.wuwGeneration===V)return!0;l(e,t)}return!1},s=(e,t)=>{const r=T(e);return v(e,T(t)),r},l=(e,{mirror:t,revoke:r})=>{r();const n=d(t);M(e,n),v(e,T(t)),H.delete(e)},u=e=>[...f(e),...p(e)],y=e=>{try{a.call(e)}catch(e){return!1}return!0},x=()=>{V=S()},$=()=>N.now(),A={splitStackTrace(){return this.stackTrace.replace(/\n$/,"").split(Z)}},E=(e,t,r,s)=>{const a=B.get(e);return a&&a.spy===s?(o(a)?(e,t,r)=>{const o={__proto__:A,target:e,propertyKey:t,stackTrace:n(E),startTime:$()};let s,a;try{s=P(e,t,r),o.success=s}catch(e){a=e,o.error=a}if(o.endTime=$(),g(o),q(o),void 0!==a)throw a;return s}:P)(e,t,r):P(e,t,r,s)},_=(e,t)=>{const r=d(e),n=u(r).filter(n=>!(r[n].configurable&&k(e,n)||(delete r[n],t.has(n)||(t.add(n),0))));return n.length&&X&&X(e,n),r},M=(e,t)=>{const r=u(t);for(const n of r)h(e,n,t[n])},O=e=>{if(void 0===e)throw C(`Argument of ${G} is missing or undefined`);if(!y(e))throw C(`Argument of ${G} does not implement interface Node`);const t=H.get(e);return t&&l(e,t),W},R=()=>(x(),W),j=e=>{if(void 0===e)throw C(`Argument of ${G} is missing or undefined`);if(!y(e))throw C(`Argument of ${G} does not implement interface Node`);const t=H.get(e);if(!t||t.wuwGeneration!==V){t&&l(e,t);const r=new L,n=_(e,r),o=c(T(e),n),{proxy:s,revoke:a}=w(o,J);v(e,s),H.set(e,{mirror:o,remarkedPropertyKeys:r,revoke:a,wuwGeneration:V})}return W},D=(e,t,r,o)=>{const a=H.get(o);if(a&&e===a.mirror){if(a.wuwGeneration===V)return((e,t,r,o,a)=>{const l={__proto__:A,target:a,propertyKey:r,stackTrace:n(D),startTime:$()},c=s(a,t);let u,d;try{u=P(t,r,o,a),l.success=u}catch(e){d=e,l.error=d}const f=_(a,e.remarkedPropertyKeys);if(i(t,f),v(a,c),l.endTime=$(),g(l),q(l),void 0!==d)throw d;return u})(a,e,t,r,o);l(o,a)}return P(e,t,r,o)},W=K(self,"wuw",j),F={get:(e,t,r)=>{const n=B.get(e);return n&&n.spy===r&&(o(n),r=e),b(e,t,r)},set:E},J={get:(t,r,n)=>{const o=H.get(n);if(o&&t===o.mirror){if(o.wuwGeneration===V)return((t,r,n)=>{const o=s(n,t);let a;try{a=b(t,r,n)}finally{v(n,o)}return((t,r,n)=>{if("style"===r&&(t=>{try{e.call(t,-1)}catch(e){return!1}return!0})(n)){let e=B.get(n);if(e)n=e.spy;else{const r=new m(n,F);e={spy:r,wuwTarget:t},B.set(n,e),n=r}}return n})(n,r,a)})(t,r,n);l(n,o)}return b(t,r,n)},set:D},B=new WeakMap,H=new WeakMap;let V,Y,Z;z.push(x);{let e;r?e=!0:(Y=((t,r)=>{const{1:n,index:o}=r.stack.match(/^(    ?at )?0\b/m);t.stackTraceOffset=o,e=n}),{0(){const e={},t=new m(e,J);H.set(t,{mirror:e}),t._=null;const r=new m(e,F);B.set(e,{spy:r,wuwTarget:t}),r._=null}}[0](),Y=((e,t)=>t.stack.slice(e.stackTraceOffset))),Z=e?/(?:^|\n)(?=    ?at )/g:"\n"}return I(W,"toString",()=>"wuw"),U(W,"watching",Q),K(W,"watch",j),K(W,"unwatch",O),K(W,"unwatchAll",R),K(Q,"watch",j),K(Q,"unwatch",O),K(Q,"unwatchAll",R),W})();let X;{const e=u((e,r)=>{const n=t(r.map(R));O("The target object %o has undeletable properties: %s",e,n)},"name",{configurable:!0,value:"remarkUndeletableProperties"}),t=n?(()=>{const e=new n("en");return t=>e.format(t)})():e=>{const{length:t}=e;return t>2?`${e.slice(0,-1).join(", ")}, and ${e[t-1]}`:e.join(" and ")},r=()=>X,o=e=>{if(null!=e&&"function"!=typeof e)throw C("remarkUndeletableProperties must be a function, undefined or null");X=e||null};z.push(()=>{X=e}),I(V,"defaultRemarkUndeletableProperties",e),j(V,"remarkUndeletableProperties",r,o),I(Q,"defaultRemarkUndeletableProperties",e),j(Q,"remarkUndeletableProperties",r,o)}const Y={};{const e=e=>(o(e),F(e),V),t=()=>(B(),V),r=e=>(o(e),H(e),V),n=e=>(o(e),J(e)),o=e=>{if(void 0===e)throw C(`Argument of ${G} is missing or undefined`);if("function"!=typeof e)throw C(`Argument of ${G} is not a function`)};U(V,"doing",Y),K(V,"do",e),K(V,"dont",r),K(V,"doNothing",t),K(V,"isDoing",n),K(Y,"do",e),K(Y,"dont",r),K(Y,"doNothing",t),K(Y,"isDoing",n)}const Z={};{const e=()=>(r(),V),t=1e4,r=()=>{m=w={next:null},h=0},n=()=>h,o=()=>J(i),a=()=>k,l=function*(){for(let e,t=m;e=t.next;({slot:t}=e))yield e.record},c={},i=e=>{const t={next:null};w.next={record:e,slot:t},w=t,h<k?++h:m=m.next.slot},g=e=>(e?F:H)(i),d=e=>{if((e=+e)<0||e!==s(e))throw y("Invalid log length");for(k=e+0;h>k;)m=m.next.slot,--h},f=()=>{const e=[];for(let t,r=m;t=r.next;({slot:r}=t))e.push(t.record);return e},p=u(()=>l(),"name",{configurable:!0,value:"values"});let m,w,h,k;z.push(()=>{r(),k=t,F(i)}),U(V,"logging",Z),I(V,"log",c),K(V,"snapshot",f),K(V,"clearLog",e),j(V,"loggingEnabled",o,g),I(V,"defaultMaxLogLength",t),j(V,"maxLogLength",a,d),I(Z,"log",c),K(Z,"snapshot",f),K(Z,"clearLog",e),j(Z,"loggingEnabled",o,g),I(Z,"defaultMaxLogLength",t),j(Z,"maxLogLength",a,d),j(c,"length",n),I(c,S.iterator,p)}const ee={};{const e="background: dodgerblue; border-radius: .2em; color: white; padding: 0 1em;",t=()=>{for(;;){const e=u.shift();if(!e)break;a(e)}u=null},r="undefined"!=typeof setImmediate?()=>setImmediate(t):(()=>{const{port1:e,port2:r}=new MessageChannel;return e.onmessage=t,()=>r.postMessage(null)})(),n=()=>J(s),o=()=>(F(s),V),s=e=>{u?u.push(e):(r(),u=[e])},a=$.markTimeline?(()=>{const t=(e,t)=>{const r=e.padEnd(13," ");l(t)!==t?(E(`${r} ${t}`),_()):M(r,t,"…")};return r=>{M("%cwuw record",e),t("target",r.target),t("property key",R(r.propertyKey)),t("stack trace",r.splitStackTrace()),t("start time",r.startTime),t("end time",r.endTime);const{error:n}=r;void 0===n?t("success",r.success):t("error",n)}})():t=>{const r="color: slategrey; font-family: Menlo, monospace;",{error:n}=t;let o,s;void 0===n?(o="success       ",s=t.success):(o="error         ",s=n),M("%cwuw record%c\n%c%s%o\n%c%s%c%s\n%c%s%o\n%c%s%o\n%c%s%o\n%c%s%c%o",e,"",r,"target        ",t.target,r,"property key  ","",R(t.propertyKey),r,"stack trace   ",t.splitStackTrace(),r,"start time    ",t.startTime,r,"end time      ",t.endTime,r,o,"",s)},c=e=>(e?F:H)(s),i=()=>(H(s),V);let u=null;z.push(()=>H(s)),U(V,"liveReporting",ee),K(V,"live",o),K(V,"unlive",i),j(V,"liveReportingEnabled",n,c),K(ee,"live",o),K(ee,"unlive",i),j(ee,"liveReportingEnabled",n,c)}K(V,"reset",()=>(W(),V)),D=null,W()}