// wuw â€“ https://github.com/fasttime/wuw
"use strict";{const e=CSSStyleDeclaration.prototype.item,t=Error,r=t.captureStackTrace,n=Intl.ListFormat,o=JSON.stringify,a=Math.floor,s=Node.prototype.hasChildNodes,{create:l,defineProperties:i,defineProperty:c,freeze:u,getOwnPropertyDescriptors:f,getOwnPropertyNames:g,getOwnPropertySymbols:d}=Object,p=Proxy,m=p.revocable,h=RangeError,{defineProperty:w,deleteProperty:y,get:k,getPrototypeOf:b,setPrototypeOf:v,set:P}=Reflect,T=Set,L=String,x=Symbol,C=TypeError,{error:A,log:M,warn:O}=console,S="object"==typeof module?require("perf_hooks").performance:performance,N=(e,t,r)=>c(e,t,{configurable:!0,value:r}),$=(e,t,r)=>{const n=i((...e)=>{try{return I=o,r(...e)}finally{I=void 0}},{length:{configurable:!0,value:r.length},name:{configurable:!0,value:t}}),o=j(e,t,n).join(".");return n},j=(e,t,r)=>{const n=(U.get(e)||[]).concat(t);return U.set(r,n),N(e,t,r),n},E=(e,t,r,n)=>c(e,t,{configurable:!0,get:r,set:n});let I,U=new Map;const G=e=>e.forEach(e=>e()),D=[],K=[],{installCallback:R,isCallbackInstalled:W,notify:_,uninstallAllCallbacks:q,uninstallCallback:z}=(()=>{const e=()=>t.clear(),t=new T;return D.push(e),{installCallback:e=>t.add(e),isCallbackInstalled:e=>t.has(e),notify:e=>{for(const r of t)try{r(e)}catch(e){A(e)}},uninstallAllCallbacks:e,uninstallCallback:e=>t.delete(e)}})(),F={},J=(()=>{const n=(()=>{const e=r?e=>{const t={};return r(t,e),t.stack.replace(/^.{5}\n/,"")}:e=>V(e,t());return"stackTraceLimit"in t?r=>{const{stackTraceLimit:n}=t;t.stackTraceLimit=1/0;const o=e(r);return t.stackTraceLimit=n,o}:e})(),o=({wuwTarget:e})=>{const t=H.get(e);if(t){if(t.wuwGeneration===Q)return!0;c(e,t)}return!1},a=(e,t)=>{const r=b(e);return v(e,b(t)),r},c=(e,{mirror:t,revoke:r})=>{r();const n=f(t);E(e,n),v(e,b(t)),H.delete(e)},h=e=>[...g(e),...d(e)],L=e=>{try{s.call(e)}catch(e){return!1}return!0},A=()=>{Q=x()},M=()=>S.now(),O=(e,t,r,a)=>{const s=J.get(e);return s&&s.spy===a?(o(s)?(e,t,r)=>{const o={target:e,propertyKey:t,stackTrace:n(O),startTime:M()};let a,s;try{a=P(e,t,r),o.success=a}catch(e){s=e,o.error=s}if(o.endTime=M(),u(o),_(o),void 0!==s)throw s;return a}:P)(e,t,r):P(e,t,r,a)},N=(e,t)=>{const r=f(e),n=h(r).filter(n=>!(r[n].configurable&&y(e,n)||(delete r[n],t.has(n)||(t.add(n),0))));return n.length&&B&&B(e,n),r},E=(e,t)=>{const r=h(t);for(const n of r)w(e,n,t[n])},U=e=>{if(void 0===e)throw C(`Argument of ${I} is missing or undefined`);if(!L(e))throw C(`Argument of ${I} does not implement interface Node`);const t=H.get(e);return t&&c(e,t),W},G=()=>(A(),W),D=e=>{if(void 0===e)throw C(`Argument of ${I} is missing or undefined`);if(!L(e))throw C(`Argument of ${I} does not implement interface Node`);const t=H.get(e);if(!t||t.wuwGeneration!==Q){t&&c(e,t);const r=new T,n=N(e,r),o=l(b(e),n),{proxy:a,revoke:s}=m(o,z);v(e,a),H.set(e,{mirror:o,remarkedPropertyKeys:r,revoke:s,wuwGeneration:Q})}return W},R=(e,t,r,o)=>{const s=H.get(o);if(s&&e===s.mirror){if(s.wuwGeneration===Q)return((e,t,r,o,s)=>{const l={target:s,propertyKey:r,stackTrace:n(R),startTime:M()},c=a(s,t);let f,g;try{f=P(t,r,o,s),l.success=f}catch(e){g=e,l.error=g}const d=N(s,e.remarkedPropertyKeys);if(i(t,d),v(s,c),l.endTime=M(),u(l),_(l),void 0!==g)throw g;return f})(s,e,t,r,o);c(o,s)}return P(e,t,r,o)},W=$("undefined"==typeof self?global:self,"wuw",D),q={get:(e,t,r)=>{const n=J.get(e);return n&&n.spy===r&&(o(n),r=e),k(e,t,r)},set:O},z={get:(t,r,n)=>{const o=H.get(n);if(o&&t===o.mirror){if(o.wuwGeneration===Q)return((t,r,n)=>{const o=a(n,t);let s;try{s=k(t,r,n)}finally{v(n,o)}return((t,r,n)=>{if("style"===r&&(t=>{try{e.call(t,-1)}catch(e){return!1}return!0})(n)){let e=J.get(n);if(e)n=e.spy;else{const r=new p(n,q);e={spy:r,wuwTarget:t},J.set(n,e),n=r}}return n})(n,r,s)})(t,r,n);c(n,o)}return k(t,r,n)},set:R},J=new WeakMap,H=new WeakMap;let Q,V;return K.push(A),r||(V=((e,t)=>{e.stackTraceOffset=t.stack.search(/^(?: *at )?0\b/m)}),{0(){const e={},t=new p(e,z);H.set(t,{mirror:e}),t._=null;const r=new p(e,q);J.set(e,{spy:r,wuwTarget:t}),r._=null}}[0](),V=((e,t)=>t.stack.slice(e.stackTraceOffset))),j(W,"watching",F),$(W,"watch",D),$(W,"unwatch",U),$(W,"unwatchAll",G),$(F,"watch",D),$(F,"unwatch",U),$(F,"unwatchAll",G),W})();let B;{const e=c((e,n)=>{const o=t(n.map(r));O("The target object %o has undeletable properties: %s",e,o)},"name",{configurable:!0,value:"remarkUndeletableProperties"}),t=n?(()=>{const e=new n("en");return t=>e.format(t)})():e=>{const{length:t}=e;return t>2?`${e.slice(0,-1).join(", ")}, and ${e[t-1]}`:e.join(" and ")},r=e=>("string"==typeof e?o:L)(e),a=()=>B,s=e=>{if(void 0!==e&&null!==e&&"function"!=typeof e)throw C("remarkUndeletableProperties must be a function, undefined or null");B=e||null};K.push(()=>{B=e}),N(J,"defaultRemarkUndeletableProperties",e),E(J,"remarkUndeletableProperties",a,s),N(F,"defaultRemarkUndeletableProperties",e),E(F,"remarkUndeletableProperties",a,s)}const H={};{const e=e=>(o(e),R(e),J),t=()=>(q(),J),r=e=>(o(e),z(e),J),n=e=>(o(e),W(e)),o=e=>{if(void 0===e)throw C(`Argument of ${I} is missing or undefined`);if("function"!=typeof e)throw C(`Argument of ${I} is not a function`)};j(J,"doing",H),$(J,"do",e),$(J,"dont",r),$(J,"doNothing",t),$(J,"isDoing",n),$(H,"do",e),$(H,"dont",r),$(H,"doNothing",t),$(H,"isDoing",n)}const Q={};{const e=()=>(r(),J),t=1e4,r=()=>{m=w={next:null},k=0},n=()=>k,o=()=>W(u),s=()=>b,l=function*(){for(let e,t=m;e=t.next;t=y.get(e))yield e},i={},u=e=>{w.next=e,w={next:null},y.set(e,w),k<b?++k:m=y.get(m.next)},f=e=>(e?R:z)(u),g=e=>{if((e=+e)<0||e!==a(e))throw h("Invalid log length");for(b=e+0;k>b;)m=y.get(m.next),--k},d=()=>{const e=[];for(let t,r=m;t=r.next;r=y.get(t))e.push(t);return e},p=c(()=>l(),"name",{configurable:!0,value:"values"});let m,w;const y=new WeakMap;let k,b;K.push(()=>{r(),b=t,R(u)}),j(J,"logging",Q),N(J,"log",i),$(J,"snapshot",d),$(J,"clearLog",e),E(J,"loggingEnabled",o,f),N(J,"defaultMaxLogLength",t),E(J,"maxLogLength",s,g),N(Q,"log",i),$(Q,"snapshot",d),$(Q,"clearLog",e),E(Q,"loggingEnabled",o,f),N(Q,"defaultMaxLogLength",t),E(Q,"maxLogLength",s,g),E(i,"length",n),N(i,x.iterator,p)}{const e=()=>{for(;;){const e=a.shift();if(!e)break;M("wuw record\n%o",e)}a=null},t="undefined"!=typeof setImmediate?()=>setImmediate(e):(()=>{const{port1:t,port2:r}=new MessageChannel;return t.onmessage=e,()=>r.postMessage()})(),r=()=>(z(o),J),n=()=>(R(o),J),o=e=>{a?a.push(e):(a=[e],t())};let a=null;{const e=()=>n();$(e,"on",n),$(e,"off",r),$(J,"live",e)}}$(J,"reset",()=>(G(D),G(K),J)),U=null,G(K)}